<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Simple iPad Camera</title>
<style>
html,body{margin:0;height:100%;background:#000;overflow:hidden}
#wrap{position:relative;height:100%;display:flex;align-items:center;justify-content:center}
#cameraBox{position:relative;width:90vw;aspect-ratio:3/4;background:#000}
video,canvas,img{width:100%;height:100%;object-fit:contain}
#grid{position:absolute;inset:0;display:none;pointer-events:none}
#grid div{position:absolute;background:rgba(255,255,255,.4)}
#grid .v1{left:33%;top:0;width:1px;height:100%}
#grid .v2{left:66%;top:0;width:1px;height:100%}
#grid .h1{top:33%;left:0;height:1px;width:100%}
#grid .h2{top:66%;left:0;height:1px;width:100%}
#ui{position:absolute;bottom:20px;width:100%;display:flex;justify-content:center;gap:20px}
button{background:rgba(0,0,0,.6);color:#fff;border:1px solid #fff;border-radius:999px;padding:10px 14px}
#shutter{width:70px;height:70px;border-radius:50%;background:#fff;border:none}
#zoom{position:absolute;right:10px;bottom:120px;display:flex;flex-direction:column;gap:8px}
#preview{position:absolute;inset:0;display:none;flex-direction:column;justify-content:space-between}
#preview img{flex:1}
#pui{display:flex;justify-content:space-between;padding:10px}
</style>
</head>
<body>
<div id="wrap">
  <div id="cameraBox">
    <video id="video" playsinline></video>
    <div id="grid">
      <div class="v1"></div><div class="v2"></div>
      <div class="h1"></div><div class="h2"></div>
    </div>
    <div id="preview">
      <img id="pimg">
      <div id="pui">
        <button id="back">戻る</button>
        <button id="share">共有</button>
      </div>
    </div>
  </div>
  <div id="zoom">
    <button data-z="1">1×</button>
    <button data-z="2">2×</button>
    <button data-z="4">4×</button>
  </div>
  <div id="ui">
    <button id="gridBtn">GRID</button>
    <button id="shutter"></button>
  </div>
</div>
<script>
const v=video,p=preview,pi=pimg;
let s,t,blob;
async function start(){
  if(s) s.getTracks().forEach(x=>x.stop());
  s=await navigator.mediaDevices.getUserMedia({video:{facingMode:'environment'},audio:false});
  v.srcObject=s;v.muted=true;await v.play();
  t=s.getVideoTracks()[0];
}
start();
shutter.onclick=async()=>{
  const c=document.createElement('canvas');
  c.width=v.videoWidth;c.height=v.videoHeight;
  c.getContext('2d').drawImage(v,0,0);
  blob=await new Promise(r=>c.toBlob(r,'image/jpeg',0.95));
  pi.src=URL.createObjectURL(blob);
  p.style.display='flex';
};
back.onclick=()=>{URL.revokeObjectURL(pi.src);p.style.display='none'};
share.onclick=async()=>{
  if(navigator.share) await navigator.share({files:[new File([blob],'photo.jpg',{type:'image/jpeg'})]});
};
gridBtn.onclick=()=>grid.style.display=grid.style.display?'':'block';
document.querySelectorAll('[data-z]').forEach(b=>b.onclick=async()=>{
  const z=+b.dataset.z;
  if(t?.getCapabilities){
    const c=t.getCapabilities();
    if(c.zoom) return t.applyConstraints({advanced:[{zoom:Math.min(z,c.zoom.max)}]});
  }
  v.style.transform=`scale(${z})`;
});
</script>
</body>
</html>
